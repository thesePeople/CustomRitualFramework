<?xml version="1.0" encoding="utf-8" ?>
<Defs>

	 <PreceptDef>
		<defName>Resurrection</defName>
		<label>resurrection</label>
		<extraTextPawnDeathLetter>{PAWN_nameDef} should be brought back to life with dark, nearly blasphemous arts.</extraTextPawnDeathLetter>
		<description>Tapping into untold necromantic powers, you revive a colonist's life</description>
		<issue>Ritual</issue>
		<impact>Medium</impact>
		<iconPath>UI/Icons/Rituals/RitualFuneral</iconPath>
		<preceptClass>Precept_Ritual</preceptClass>
		<ritualPatternBase>ResurrectionRitual</ritualPatternBase>
		<allowDuplicates>true</allowDuplicates>
		<countsTowardsPreceptLimit>false</countsTowardsPreceptLimit>
		<selectionWeight>1.0</selectionWeight>
		<displayOrderInImpact>100</displayOrderInImpact>
		<ignoreLimitsInEditMode>false</ignoreLimitsInEditMode>
		<receivesExpectationsQualityOffset>true</receivesExpectationsQualityOffset>
	</PreceptDef>

	<RitualPatternDef>
		<defName>ResurrectionRitual</defName>
		<nameMaker>NamerRitualFuneral</nameMaker>
		<ritualExpectedDesc>Once a {IDEO} member dies, other {MEMBERS} gather around their grave for {RITUAL_labelDef}.</ritualExpectedDesc>
		<ritualExpectedPostfix>{0} {1} want to carry out the funeral as soon as possible.</ritualExpectedPostfix>
		<ritualObligationTriggers>
		  <li Class="RitualObligationTrigger_MemberDiedProperties">
			<mustBePlayerIdeo>true</mustBePlayerIdeo>
		  </li>
		</ritualObligationTriggers>
		<ritualObligationTargetFilter>GraveWithTargetsCorpse</ritualObligationTargetFilter>
		<ritualBehavior>ResurrectionRitual</ritualBehavior>
		<ritualOutcomeEffect>AttendedResurrectionRitual</ritualOutcomeEffect>
	</RitualPatternDef>
	
	<RitualBehaviorDef>
		<defName>ResurrectionRitual</defName>
		<durationTicks>5000</durationTicks>
		<workerClass>RitualBehaviorWorker_Funeral</workerClass>
		<roles>
		  <li Class="RitualRoleTag">
			<label>speaker</label>
			<id>moralist</id>
			<precept>IdeoRole_Moralist</precept>
			<tag>Moralist</tag>
			<maxCount>1</maxCount>
			<substitutable>true</substitutable>
			<countsAsParticipant>False</countsAsParticipant>
		  </li>
		</roles>
		<stages>
		  <li>
			<defaultDuty>Spectate</defaultDuty>
			<endTriggers>
			  <li Class="StageEndTrigger_DurationPercentage">
				<percentage>1</percentage>
			  </li>
			</endTriggers>
			<roleBehaviors>
			  <li>
				<roleId>moralist</roleId>
				<dutyDef>SpeakOnCellFuneral</dutyDef>
			  <speakerInteraction>Speech_Funeral</speakerInteraction>
				<customPositions>
				  <li Class="RitualPosition_Lectern">
					<maxDistanceToFocus>5</maxDistanceToFocus>
				  </li>
				  <li Class="RitualPosition_BesideThing" />
				</customPositions>
			  </li>
			</roleBehaviors>
			<visualEffectDef>Funeral</visualEffectDef>
		  </li>
		</stages>
	</RitualBehaviorDef>
  
  <RitualOutcomeEffectDef>
     <description>Depending on ritual quality, participants will get between {MINMOOD} and {MAXMOOD} mood for {MOODDAYS} days.</description>
    <workerClass>TPRitualAttachableOutcomes.RitualOutcomeEffectWorker_FromQuality_TP_Custom</workerClass>
    <allowAttachableOutcome>false</allowAttachableOutcome>
    <outcomeChances>
      <li>
        <label>Terrible</label>
        <chance>0.05</chance>
        <memory>TerribleFuneral</memory>
        <description>The {0} was a terrible! Everyone felt insulted for having had to endure it.</description>
        <positivityIndex>-2</positivityIndex>
      </li>
      <li>
        <label>Lackluster</label>
        <chance>0.15</chance>
        <memory>LacklusterFuneral</memory>
        <description>The {0} was lackluster. The speech was long-winded and failed to resolve any emotions.</description>
        <positivityIndex>-1</positivityIndex>
      </li>
      <li>
        <label>Good</label>
        <chance>0.6</chance>
        <memory>GoodFuneral</memory>
        <description>The {0} was good. The speaker's final words provided a path for everyone move on.</description>
        <positivityIndex>1</positivityIndex>
      </li>
      <li>
        <label>Heartwarming</label>
        <chance>0.2</chance>
        <memory>HeartwarmingFuneral</memory>
        <description>The {0} was heartwarming. The speech was captivating and heartfelt, and everyone came away focused on good memories.</description>
        <positivityIndex>2</positivityIndex>
      </li>
    </outcomeChances>
	
	<modExtensions>
		    <li Class="TPRitualAttachableOutcomes.RitualAttachableOutcomeEffectDef_TP_Custom">
				<addInnerPawn>true</addInnerPawn>
				<applyToInnerPawn>true</applyToInnerPawn>
				<resurrect>true</resurrect>
				<hediffToAdd><li>HarvestBonus</li></hediffToAdd>
			</li>
	</modExtensions>
	
	<defName>AttendedResurrectionRitual</defName>
    <comps>
      <li Class="RitualOutcomeComp_RolePresentNotSubstituted">
        <roleId>moralist</roleId>
        <label>moral guide present</label>
        <qualityOffset>0.3</qualityOffset>
      </li>
      <li Class="RitualOutcomeComp_ParticipantCount">
        <label>participant count</label>
        <curve>
          <points>
            <li>(1,  0.0)</li>
            <li>(5,  0.5)</li>
            <li>(10, 0.7)</li>
          </points>
        </curve>
      </li>
    </comps>
  </RitualOutcomeEffectDef>
  
 </Defs>